@page "/weather"

<PageTitle>Tracker Spese</PageTitle>

<h1>Le mie spese</h1>

<p>Questa pagina ti permette di tenere traccia delle tue spese personali.</p>

<div class="mb-3">
    <label for="descrizione" class="form-label">Descrizione:</label>
    <input id="descrizione" class="form-control" @bind="descrizione" />

    <label for="categoria" class="form-label mt-2">Categoria:</label>
    <input id="categoria" class="form-control" @bind="categoria" />

    <label for="importo" class="form-label mt-2">Importo (€):</label>
    <input id="importo" type="number" class="form-control" @bind="importo" />

    <button class="btn btn-primary mt-3" @onclick="AggiungiSpesa">Aggiungi spesa</button>
</div>

@if (spese.Any())
{
    <h3>Elenco spese</h3>
    <table class="table">
        <thead>
            <tr>
                <th>Data</th>
                <th>Descrizione</th>
                <th>Categoria</th>
                <th>Importo (€)</th>
                <th>Azioni</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var spesa in spese)
            {
                <tr>
                    <td>@spesa.Data.ToShortDateString()</td>
                    <td>@spesa.Descrizione</td>
                    <td>@spesa.Categoria</td>
                    <td>@spesa.Importo.ToString("0.00")</td>
                    <td>
                        <button class="btn btn-sm btn-danger" @onclick="@(() => RimuoviSpesa(spesa))">Rimuovi</button>
                    </td>
                </tr>
            }
        </tbody>
        <tfoot>
            <tr>
                <td colspan="3"><strong>Totale:</strong></td>
                <td colspan="2"><strong>@spese.Sum(s => s.Importo).ToString("0.00") €</strong></td>
            </tr>
        </tfoot>
    </table>
}
else
{
    <p><em>Nessuna spesa registrata.</em></p>
}

@code {
    private string descrizione = string.Empty;
    private string categoria = string.Empty;
    private decimal importo;

    private List<Spesa> spese = new();

    private void AggiungiSpesa()
    {
        if (!string.IsNullOrWhiteSpace(descrizione) && importo > 0)
        {
            spese.Add(new Spesa
            {
                Data = DateTime.Today,
                Descrizione = descrizione,
                Categoria = categoria,
                Importo = importo
            });

            // Reset dei campi
            descrizione = string.Empty;
            categoria = string.Empty;
            importo = 0;
        }
    }

    private void RimuoviSpesa(Spesa spesa)
    {
        spese.Remove(spesa);
    }

    public class Spesa
    {
        public DateTime Data { get; set; }
        public string Descrizione { get; set; } = string.Empty;
        public string Categoria { get; set; } = string.Empty;
        public decimal Importo { get; set; }
    }
}
